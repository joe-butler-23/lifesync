"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(require("classnames")),o=require("draft-js"),a=require("@reach/menu-button");require("@reach/menu-button/styles.css");var r=e(require("linkify-it")),c=e(require("memoize-one")),l=e(require("escape-string-regexp")),s=require("immutable"),i=e(s);require("draft-js/dist/Draft.css");const d=t.createContext({});function u(e){return t.createElement("svg",Object.assign({fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",stroke:"currentColor"},e),t.createElement("path",{d:"M5 13l4 4L19 7"}))}function g(e){return t.createElement("svg",Object.assign({fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",stroke:"currentColor"},e),t.createElement("path",{d:"M17 8l4 4m0 0l-4 4m4-4H3"}))}function p(e){return t.createElement("svg",Object.assign({fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",stroke:"currentColor"},e),t.createElement("path",{d:"M7 16l-4-4m0 0l4-4m-4 4h18"}))}function m(e){return t.createElement("svg",Object.assign({fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",stroke:"currentColor"},e),t.createElement("path",{d:"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"}))}function f(e){return t.createElement("svg",Object.assign({fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,viewBox:"0 0 24 24",stroke:"currentColor"},e),t.createElement("path",{d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"}))}var y="menu_styles-module_menu-icon__jECU2",h="button_styles-module_button__2KbPc",k="button_styles-module_icon-button__2ddnV";function E({onExpandAllClick:e,onCollapseAllClick:o,onIndentClick:r,onOutdentClick:c,onToggleCompletionClick:l,isBookmarked:s,onBookmarkClick:i}){return t.createElement("div",{className:"menu_styles-module_menu-container__1H_0Q"},t.createElement("div",{className:"menu_styles-module_menu-left-container__Ac7Ac"},t.createElement("button",{onMouseDown:e=>{e.stopPropagation(),e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),l()},"aria-label":"Mark complete",className:n(k,h),title:"Mark complete"},t.createElement(u,{className:y})),"Â ",t.createElement("button",{onMouseDown:e=>{e.stopPropagation(),e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),c()},"aria-label":"Outdent",className:n(k,h),title:"Outdent"},t.createElement(p,{className:y})),t.createElement("button",{onMouseDown:e=>{e.stopPropagation(),e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),r()},"aria-label":"Indent",className:n(k,h),title:"Indent"},t.createElement(g,{className:y}))),t.createElement("div",{className:"menu_styles-module_menu-right-container__2RbN3"},t.createElement("button",{className:n(k,h),style:{marginRight:"1rem"},onMouseDown:e=>{e.stopPropagation(),e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),i()},"aria-label":"Bookmark item",title:"Bookmark item","data-bookmarked":s},t.createElement(f,{className:n("menu_styles-module_menu-icon-large__2BwF4",{"menu_styles-module_bookmarked__2CFZk":s,"menu_styles-module_not-bookmarked__1YiMp":!s})})),t.createElement(a.Menu,null,()=>t.createElement(t.Fragment,null,t.createElement(a.MenuButton,null,t.createElement("button",{className:n(k,h),"aria-label":"Show menu"},t.createElement(m,{className:y}))),t.createElement(a.MenuList,{className:"menu_styles-module_slide-down__1ZJ7b"},t.createElement(a.MenuItem,{onSelect:e},"Expand all"),t.createElement(a.MenuItem,{onSelect:o},"Collapse all"))))))}function I({children:e,handleSearchInputChange:n}){return t.createElement("button",{style:{textDecoration:"underline",color:"rgb(134, 140, 144)",cursor:"pointer"},onClick:()=>{e[0]&&e[0].props&&e[0].props.text&&n&&n(e[0].props.text)},"data-testid":"hashtag"},e)}var S=t.memo(I);function _(e){return t.createElement("span",{style:{background:"rgb(255,230,153)"}},e.children)}function b(e){const n=t.Children.map(e.children,e=>e&&e.props?e.props.text:"").join("");return t.createElement("a",{href:n,onClick:()=>window.open(n,"_blank"),className:"link_styles-module_link__3R12D"},e.children)}const K=r(),C=/#[\w\u0590-\u05ff]+/g;function M(e,t,n){const o=t.getText();let a,r;for(;null!==(a=e.exec(o));)r=a.index,n(r,r+a[0].length)}function w(e,t){M(C,e,t)}function x(e,t){const n=K.match(e.getText());n&&n.forEach(e=>t(e.index,e.lastIndex))}const T=c((e="")=>{const t=new RegExp(l(e),"gi");return new o.CompositeDecorator([{strategy:w,component:S},{strategy:(n,o)=>{e&&M(t,n,o)},component:_},{strategy:x,component:b}])});function v(e){const t=e.getCurrentContent(),n=e.getSelection(),o=t.getBlockMap(),a=n.getAnchorKey(),r=t.getBlockForKey(a),c=n.getFocusKey(),l=t.getBlockForKey(c);return{contentState:t,selectionState:n,blockMap:o,anchorKey:a,anchorBlock:r,focusKey:c,focusBlock:l}}const O="root";function B(e){return 1e5*e}function D(e,t){return Math.round((e+t)/2)}function N(e){return e+1e5}function A(e){return new o.ContentBlock({key:o.genKey(),type:"unordered-list-item",text:"",depth:0,...e})}function L(e){const t=A({text:""}).set("depth",1).set("data",i.Map({parentId:e,pos:B(1)})),n=function(e){return A({text:"",key:e})}(e);let a=o.EditorState.createWithContent(o.ContentState.createFromBlockArray([n,t]),T());return a=o.EditorState.forceSelection(a,o.SelectionState.createEmpty(t.getKey())),a}function P(e,t,n){let o=-1;const a=e.get(t);if(!a)return o;let r=e.get(a.getIn(["data","parentId"]));for(;r&&(!n||r.getKey()!==n);)o+=1,r=e.get(r.getIn(["data","parentId"]));return o}function z(e,t){return!!e.find(e=>!(!e||e.getIn(["data","parentId"])!==t))}function R(e,t){const n=e.get(t);return e.set(t,n.setIn(["data","hasChildren"],z(e,t)))}function j(e,t){return e.filter(e=>!(!e||e.getIn(["data","parentId"])!==t))}function F(e,t){const n=e.get(t),o=n.getIn(["data","parentId"]);return e.filter(e=>!(!e||e.getIn(["data","parentId"])!==o)).find(e=>!!(e&&e.getIn(["data","pos"])>n.getIn(["data","pos"])))}function W(e,t){const n=e.get(t),o=n.getIn(["data","parentId"]);return e.filter(e=>!(!e||e.getIn(["data","parentId"])!==o)).reverse().find(e=>!!(e&&e.getIn(["data","pos"])<n.getIn(["data","pos"])))}function q(e,t){const n=e.get(t);return e.toSeq().skipUntil((e,n)=>n===t).takeWhile((o,a)=>!(!o||!(a===t||P(e,o.getKey())>P(e,n.getKey()))))}function U(e,t,n){const{contentState:a,blockMap:r}=v(e),c=A({depth:n});let l;l=t?function(e,t,n){const o=q(e,t);let a=t;const r=t;let c=B(1);return o&&o.count()>1&&(a=o.last().getKey(),c=N(o.last().getIn(["data","pos"]))),function(e,t,n){return function(e,t,n,o){const a=e.get(n),r=e.toSeq().takeUntil((e,t)=>t===n),c=e.toSeq().skipUntil((e,t)=>t===n).rest();return r.concat([[n,a]]).concat(t).concat(c).toOrderedMap()}(e,t,n)}(e,s.OrderedMap({[n.getKey()]:n.setIn(["data","parentId"],r).setIn(["data","pos"],c)}),a)}(r,t,c):r.set(c.getKey(),c);const i=o.SelectionState.createEmpty(c.getKey()),d=a.merge({blockMap:l,selectionBefore:i,selectionAfter:i.merge({anchorKey:c.getKey(),anchorOffset:0,focusKey:c.getKey(),focusOffset:0})});return o.EditorState.forceSelection(o.EditorState.push(e,d,"add-new-item"),i)}function H(e,t,n){const a=o.SelectionState.createEmpty(n),[r,c]=function(e,t){const n=t.getAnchorKey(),o=q(e.getBlockMap(),n);return[o.first().getKey(),o.last().getKey()]}(e,a),l=t.keySeq().findIndex(e=>e===r),s=t.keySeq().findIndex(e=>e===c),i=o.ContentState.createFromBlockArray(function e(t,n){const o=n.getDepth(),a=n.getKey(),r=function(e){const t=[...e];return t.sort((e,t)=>e.getIn(["data","pos"])-t.getIn(["data","pos"])),t}(t.filter(e=>!(!e||e.getIn(["data","parentId"])!==a)).map(e=>e?e.set("depth",o+1):e).toArray());return r?[n].concat(r.map(n=>e(t,n)).flat()):[n]}(t,t.get(n))).getBlockMap();return t.slice(0,l).concat(i,t.slice(s+1))}function X(e,t){const{blockMap:n}=v(e),o=n.get(t);return n.toSeq().takeUntil((e,n)=>n===t).reverse().skipWhile(e=>!!(e&&P(n,e.getKey())>=P(n,o.getKey()))).first()}function G(e){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},e),t.createElement("path",{d:"M12 21l-12-18h24z"}))}function V({collapsed:e,itemId:o,isCollapsible:a}){const{onZoom:r,onExpandClick:c,onCollapseClick:l}=t.useContext(d);return t.createElement("div",{className:"disc_styles-module_disc-container__3t72L",style:{marginTop:2}},a&&t.createElement("button",{className:"disc_styles-module_collapse-button__116tC",style:{marginTop:-2},onClick:()=>{e?"function"==typeof c&&c(o):"function"==typeof l&&l(o)},"data-testid":"collapse-arrow"},t.createElement(G,{className:n("disc_styles-module_down-arrow-icon__2wGmr",{"disc_styles-module_collapsed-down-arrow-icon__2c6c9":e}),width:8,height:8})),t.createElement("div",{contentEditable:!1,className:n("disc_styles-module_disc__MiMX-",{"disc_styles-module_disc-collapsed__2A4lQ":e}),onClick:()=>{"function"==typeof r&&r(o)},"data-testid":"outer-disc"},t.createElement("svg",{width:"6",height:"6",className:"disc_styles-module_disc-icon__1QagH",viewBox:"0 0 6 6"},t.createElement("circle",{cx:"3",cy:"3",r:"3"}))))}function Z(e){return t.createElement("svg",Object.assign({version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512",enableBackground:"new 0 0 512 512",xmlSpace:"preserve"},e),t.createElement("g",null,t.createElement("g",null,t.createElement("path",{d:"M492,236H276V20c0-11.046-8.954-20-20-20c-11.046,0-20,8.954-20,20v216H20c-11.046,0-20,8.954-20,20s8.954,20,20,20h216\n\t\t\tv216c0,11.046,8.954,20,20,20s20-8.954,20-20V276h216c11.046,0,20-8.954,20-20C512,244.954,503.046,236,492,236z"}))))}function Q(e){return t.createElement("svg",Object.assign({version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512",enableBackground:"new 0 0 512 512",xmlSpace:"preserve"},e),t.createElement("g",null,t.createElement("rect",{y:236,width:512,height:40})))}function J(e,t){const{block:n,blockProps:{hidden:o,baseDepth:a,searchText:r}}=e,{block:c,blockProps:{hidden:l,baseDepth:s,searchText:i}}=t;return n===c&&o===l&&a===s&&r===i}const Y=t.memo(e=>{const{block:a,blockProps:r}=e,{onExpandClick:c,onCollapseClick:l,hidden:s,baseDepth:i,zoomedInItemId:d}=r,u=a.getIn(["data","collapsed"]),g=a.getIn(["data","completed"]),p=a.getIn(["data","hasChildren"]);if(s)return null;const m=a.getDepth(),f=n("item_styles-module_item-base__3sOp0",{"item_styles-module_completed___ObuM":g,"item_styles-module_regular-item__23xsf":d!==a.getKey(),"item_styles-module_zoomed-in-item__18pC6":d===a.getKey(),"item_styles-module_small-text__u0K1d":d!==a.getKey()&&m>i+1});return function e(n,o,a){return a<=0?n:t.createElement("div",o,e(n,o,a-1))}(t.createElement("div",{className:f,style:{marginLeft:-13},"data-testid":"list-item"},a.getDepth()>i&&t.createElement(V,{itemId:a.getKey(),collapsed:!!u,isCollapsible:p}),t.createElement("div",{className:"item_styles-module_item-container__3B3Jx"},t.createElement(o.EditorBlock,Object.assign({},e)),p?u?t.createElement("button",{contentEditable:!1,className:"item_styles-module_mobile-collapse-button__3cd1_",onMouseDown:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),c(a.getKey())},"data-testid":"expand-button"},t.createElement(Z,{width:16,height:16})):t.createElement("button",{contentEditable:!1,className:"item_styles-module_mobile-collapse-button__3cd1_",onMouseDown:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),l(a.getKey())},"data-testid":"collapse-button"},t.createElement(Q,{width:16,height:16})):null)),{className:n("depth-manager","item_styles-module_depth-manager__1pfhr")},m-i-1)},J);function $(e,t,n,o,a){const r=e.getBlockMap();let c=r.get(n);const l=c.getIn(["data","parentId"]);c=c.setIn(["data","parentId"],o).setIn(["data","pos"],a);let s=r.set(n,c).set(t.getKey(),t);return s=H(e.set("blockMap",s),s,l),o!==l&&(s=s.merge(q(r,n)),s=s.set(n,c),s=H(e.set("blockMap",s),s,o)),s}function ee(e,t){const{contentState:n,blockMap:a,selectionState:r,anchorKey:c}=v(e);let l=function(e){const{blockMap:t,anchorKey:n}=v(e),o=t.get(n),a=W(t,n);if(a)return a;const r=t.get(o.getIn(["data","parentId"])),c=W(t,r.getKey());if(!c)return null;const l=j(t,c.getKey());return l.count()>0?l.last():c}(e);if(!l)return console.log("moveCurrentBlockUp","nothing to swap with"),e;if(t&&(l.getKey()===t||n.getBlockAfter(l.getKey())&&n.getBlockAfter(l.getKey()).getKey()===t))return e;const s=a.get(c),i=s.getIn(["data","parentId"]);let d,u;l.getIn(["data","parentId"])===i?(d=i,u=l.getIn(["data","pos"]),l=l.setIn(["data","pos"],s.getIn(["data","pos"]))):P(a,l.getKey())===P(a,s.getKey())?(d=l.getIn(["data","parentId"]),u=N(l.getIn(["data","pos"]))):(d=l.getKey(),u=B(1));const g=$(n,l,c,d,u),p=n.merge({blockMap:g}),m=new o.SelectionState({anchorKey:c,anchorOffset:r.getAnchorOffset(),focusKey:c,focusOffset:r.getFocusOffset()}),f=o.EditorState.push(e,p,"move-block");return o.EditorState.forceSelection(f,m)}function te(e,t){const{contentState:n,selectionState:a,blockMap:r,anchorKey:c}=v(e);let l=function(e){const{blockMap:t,anchorKey:n}=v(e),o=t.get(n),a=F(t,n);if(a)return a;const r=t.get(o.getIn(["data","parentId"]));return F(t,r.getKey())||null}(e);if(!l||l.getKey()===c)return console.log("moveCurrentBlockDown","nothing to swap with"),e;const s=r.get(c),i=s.getIn(["data","parentId"]);let d,u;if(l.getIn(["data","parentId"])===i)d=i,u=l.getIn(["data","pos"]),l=l.setIn(["data","pos"],s.getIn(["data","pos"]));else{if(t===s.getIn(["data","parentId"]))return e;d=l.getKey();const n=function(e,t){return e.find(e=>!(!e||e.getIn(["data","parentId"])!==t))}(r,l.getKey());u=n?D(0,n.getIn(["data","pos"])):B(1)}const g=$(n,l,c,d,u),p=n.merge({blockMap:g}),m=new o.SelectionState({anchorKey:c,anchorOffset:a.getAnchorOffset(),focusKey:c,focusOffset:a.getFocusOffset()}),f=o.EditorState.push(e,p,"move-block");return o.EditorState.forceSelection(f,m)}function ne(e,t,n){const{contentState:a,selectionState:r,blockMap:c}=v(e),l=c.get(n);if(!l||l.getIn(["data","collapsed"])===t)return e;const s=q(c,n);if(!s||1===s.count())return e;const i=a.merge({blockMap:c.set(n,l.setIn(["data","collapsed"],t))}),d=new o.SelectionState({anchorKey:n,anchorOffset:r.getAnchorOffset(),focusKey:void 0,focusOffset:r.getFocusOffset()}),u=o.EditorState.push(e,i,t?"collapse-list":"expand-list");return o.EditorState.forceSelection(u,d)}function oe(e,t){const{anchorKey:n}=v(e);return ne(e,!0,t||n)}function ae(e,t){const{anchorKey:n}=v(e);return ne(e,!1,t||n)}function re(e,t,n,a=!1){const r=e.getSelection(),c=r.getStartKey(),l=e.getCurrentContent(),s=l.getBlockMap(),i=l.getBlockForKey(c),d=l.getBlockBefore(c),u=n?P(s,n)+1:0;if(!d||P(s,i.getKey())<u||a&&P(s,i.getKey())===u)return console.log("This seems like the first list item. Nothing to do."),e;if(P(s,i.getKey())>=t)return e;if(!a&&P(s,i.getKey())-P(s,d.getKey())>=1)return e;const g=function(e,t,n){const o=t.getAnchorKey();let a=e.getBlockMap(),r=a.get(o);const c=P(a,o)+n,l=r.getIn(["data","parentId"]),s=function(e,t,n){let o=e.getBlockBefore(t);const a=e.getBlockMap();for(;o;){if(P(a,o.getKey())<n)return o.getKey();o=e.getBlockBefore(o.getKey())}return O}(e,o,c);if(r=r.setIn(["data","parentId"],s),a=a.set(r.getKey(),r),r=r.setIn(["data","pos"],function(e,t,n){const o=e.filter(e=>!(!e||e.get("data").get("parentId")!==n)).toArray();let a,r,c=0;for(;c<o.length;){if(o[c].getKey()===t){a=o[c-1],r=o[c+1];break}c+=1}return a&&r?D(a.get("data").get("pos"),r.get("data").get("pos")):a?N(a.get("data").get("pos")):B(1)}(a,r.getKey(),s)),a=a.set(o,r),a=H(e.set("blockMap",a),a,s),1===n){const e=a.get(s);e.getIn(["data","collapsed"])&&(a=a.set(s,e.setIn(["data","collapsed"],!1)))}return a=R(R(a,l),s),e.merge({blockMap:a,selectionBefore:t,selectionAfter:t})}(l,r,a?-1:1);return o.EditorState.push(e,g,"adjust-depth")}function ce(e,t){const{selectionState:n,blockMap:a}=v(e);let r=n;const c=q(a,t);if(c.count()>1){if(!c.find(e=>!(!e||e.getKey()!==n.getAnchorKey()))){const e=c.rest().first();r=o.SelectionState.createEmpty(e.getKey())}}else n.getAnchorKey()!==t&&(r=o.SelectionState.createEmpty(t));return o.EditorState.forceSelection(e,r)}function le(e,t){const{editorState:n,zoomedInItemId:a}=e,{blockMap:r,contentState:c}=v(n);let l=q(r,a);l=l.rest().map(e=>e&&z(r,e.getKey())?e.setIn(["data","collapsed"],t):e);const s=r.merge(l),i=o.EditorState.push(n,c.set("blockMap",s),"collapse-all");return{...e,editorState:i}}function se(e,t){const{blockMap:n,contentState:a}=v(e),r=n.get(t),c=n.set(t,r.setIn(["data","bookmarked"],!r.getIn(["data","bookmarked"])));return o.EditorState.push(e,a.set("blockMap",c),"bookmark")}function ie(e,t){switch(t.type){case"CHANGE":return{...e,editorState:t.editorState};case"INSERT_SOFT_NEWLINE":return{...e,editorState:o.RichUtils.insertSoftNewline(e.editorState)};case"SET_ROOT_EDITOR_STATE":return{...e,rootEditorState:t.editorState};case"SET_EDITOR_STATE":return{...e,editorState:t.editorState};case"SET_STATE":return{...e,[t.prop]:t.val};case"MOVE_UP":return{...e,editorState:ee(e.editorState,e.zoomedInItemId)};case"MOVE_DOWN":return{...e,editorState:te(e.editorState,e.zoomedInItemId)};case"COLLAPSE_ITEM":return{...e,editorState:oe(e.editorState,t.blockKey)};case"EXPAND_ITEM":return{...e,editorState:ae(e.editorState,t.blockKey)};case"EXPAND_ALL":return le(e,!1);case"COLLAPSE_ALL":return le(e,!0);case"TOGGLE_COMPLETION":return function(e){const{blockMap:t,anchorBlock:n,contentState:a,selectionState:r}=v(e.editorState);if(""===n.getText().trim())return e;const c=q(t,n.getKey()),l=t.merge(c.map(e=>e?e.setIn(["data","completed"],!n.getIn(["data","completed"])):e)),s=a.merge({blockMap:l,selectionBefore:r,selectionAfter:r});return{...e,editorState:o.EditorState.push(e.editorState,s,"toggle-completion")}}(e);case"DELETE_CURRENT_ITEM ":return function(e){const{editorState:t}=e,{contentState:n,blockMap:a,focusKey:r,focusBlock:c}=v(t);if(!r)return e;const l=q(a,r),s=a.get(r).getIn(["data","parentId"]);let i=a.toSeq().filter((e,t)=>!(!t||l.has(t))).toOrderedMap();if(!i||0===i.count()||1===i.count()&&i.has(O))return e;const d=n.getBlockBefore(c.getKey());let u;return u=d?new o.SelectionState({anchorKey:d.getKey(),anchorOffset:d.getText().length-1,focusKey:d.getKey(),focusOffset:d.getText().length-1}):o.SelectionState.createEmpty(i.toSeq().first().getKey()),i=R(i,s),{...e,editorState:o.EditorState.push(t,n.merge({blockMap:i,selectionBefore:u,selectionAfter:u}),"delete-item")}}(e);case"ZOOM":return function(e,t){const{editorState:n,zoomedInItemId:o}=e,{blockMap:a}=v(n);if(o===t)return console.log("We are at the root. Nothing to zoom out into."),e;let r;t&&(r=a.get(t));const c=r?r.getKey():O;return{...e,editorState:ce(e.editorState,c),zoomedInItemId:c}}(e,t.blockKey);case"INDENT":return{...e,editorState:re(e.editorState,1e3,e.zoomedInItemId)};case"DEDENT":return{...e,editorState:re(e.editorState,1e3,e.zoomedInItemId,!0)};case"BOOKMARK":return{...e,editorState:se(e.editorState,e.zoomedInItemId)};default:return e}}Y.displayName="Item";let de={};function ue(e,t,n,o){const{blockMap:a}=v(e),r=t.getIn(["data","parentId"]);if(void 0!==de[r])return de[r]&&t.getKey()!==n;const c=t.getKey()===O||t.getDepth()<a.get(n).getDepth()||t.getKey()!==n&&!o&&function(e,t,n){const o=e.get(t);if(!o)return!1;let a=e.get(o.getIn(["data","parentId"]));for(;a&&(!n||a.getKey()!==n);){if(a.getIn(["data","collapsed"]))return!0;a=e.get(a.getIn(["data","parentId"]))}return!1}(a,t.getKey(),n)||o&&!t.getText().toLowerCase().includes(o.toLowerCase())||function(e,t,n){const{blockMap:o}=v(e);return!q(o,n).find(e=>!(!e||e.getKey()!==t.getKey()))}(e,t,n);return t.getKey()!==O&&(de[r]=c,c&&(de[t.getKey()]=c)),c}const ge={loading:!0,zoomedInItemId:O,rootEditorState:L(O),editorState:L(O)},pe=t.memo(e=>{const{max:n}=e;return n>4?t.createElement("style",null,((e,t)=>{let n="\n.public-DraftStyleDefault-unorderedListItem:empty {\n  display: none\n}\n";for(let e=0;e<=t;e++)n+=`\n.${"public-DraftStyleDefault-depth-deepnotes-"+e}.public-DraftStyleDefault-listLTR { \nlist-style: none;\npadding: 0;\nmargin: 0;\n}\n`;return n})(0,n)):null});pe.displayName="ListNestingStyles";const me=e=>{if("unordered-list-item"===e.getType()){const t=e.getDepth();return"list-none m-0 public-DraftStyleDefault-depth-deepnotes-"+String(t)}return""};let fe={};function ye(e){const a=t.useRef(null),r=t.useRef(null),[c,l]=t.useReducer(ie,ge),{searchText:s,initialEditorState:i,initialZoomedInItemId:u=O,onChange:g,onRootChange:p,editorWrapperStyle:m,onBookmarkClick:f,withToolbar:y=!0}=e,{editorState:I,zoomedInItemId:S}=c;window.state=c,function(e,n){t.useEffect(()=>{if(n===O)document.title="deepnotes - Note taking made easy. And deep.";else{const t=e.getCurrentContent().getBlockMap().get(n).getText();document.title=t}},[e,n])}(I,S);const _=t.useCallback(e=>{l({type:"SET_EDITOR_STATE",editorState:e})},[l]),b=t.useCallback(e=>{l({type:"EXPAND_ITEM",blockKey:e})},[l]),K=t.useCallback(e=>{l({type:"COLLAPSE_ITEM",blockKey:e})},[l]),C=t.useCallback(e=>{l({type:"ZOOM",blockKey:e}),"function"==typeof p&&p(e)},[l,p]);t.useEffect(()=>{S!==u&&C(u)},[C,u]);const M=t.useCallback(function(e,t){let n;return function(...t){clearTimeout(n),n=setTimeout(()=>{e.apply(null,t)},250)}}((e,t)=>{_(function(e,t=""){const n=o.EditorState.createWithContent(e.getCurrentContent(),T(t));return o.EditorState.set(n,{selection:e.getSelection(),undoStack:e.getUndoStack(),redoStack:e.getRedoStack(),lastChangeType:e.getLastChangeType()})}(e,t))}),[_]),w=function(e){const n=t.useRef(void 0);return t.useEffect(()=>{n.current=e},[e]),n.current}(s);t.useEffect(()=>{void 0!==w&&s!==w&&M(I,s)},[s]),t.useEffect(()=>{"function"==typeof g&&g(I)},[I]);const x=I.getCurrentContent().getBlockMap().get(S).getDepth();function P(){r&&r.current&&r.current.editor!==document.activeElement?r.current.focus():console.log("Editor already in focus")}de={},t.useEffect(()=>{if(setTimeout(()=>{P()},100),window.addEventListener("keydown",e=>{e&&27===e.which&&a&&a.current&&a.current.focus(),e.metaKey&&191===e.which&&r.current&&r.current.editor!==document.activeElement&&(e.preventDefault(),e.stopPropagation())}),i){const e=function(e,t){const{blockMap:n}=v(e);if(!n||n.count()<1)return L(O);const a=function e(t,n){const o=n.getKey(),a=n.getDepth(),r=t.filter(e=>!(!e||e.getIn(["data","parentId"])!==o)).toArray().map((e,n)=>e.setIn(["data","pos"],B(n+1)).setIn(["data","hasChildren"],z(t,e.getKey())).set("depth",a+1));return r?[n].concat(r.map(n=>e(t,n)).flat()):[n]}(n,n.get(t)),r=o.EditorState.createWithContent(o.ContentState.createFromBlockArray(a),T());let c;if(a.length>1)c=o.SelectionState.createEmpty(a[1].getKey());else{if(!(a.length>0))return r;c=o.SelectionState.createEmpty(a[0].getKey())}return o.EditorState.forceSelection(r,c)}(i,O);!function(e){l({type:"SET_ROOT_EDITOR_STATE",editorState:e})}(e),_(e)}return()=>{}},[]);const R=t.useCallback(e=>{e.preventDefault(),l(e.shiftKey?{type:"DEDENT"}:{type:"INDENT"})},[l]),W=t.useCallback(e=>e.altKey?(l({type:"INSERT_SOFT_NEWLINE"}),"handled"):"not-handled",[l]),q=t.useCallback(()=>{l({type:"MOVE_UP"})},[l]),G=t.useCallback(()=>{l({type:"MOVE_DOWN"})},[l]),V=t.useCallback(()=>{l({type:"TOGGLE_COMPLETION"})},[l]),Q=t.useCallback(()=>{window.location.hash=""},[]),J=t.useCallback(()=>{l({type:"DELETE_CURRENT_ITEM "})},[l]),$=t.useCallback(()=>{l({type:"INDENT"})},[l]),ee=t.useCallback(()=>{l({type:"DEDENT"})},[l]),te=t.useCallback(()=>{l({type:"EXPAND_ALL"})},[l]),ne=t.useCallback(()=>{l({type:"COLLAPSE_ALL"})},[l]);t.useEffect(()=>{fe={onZoom:C,onExpandClick:b,onCollapseClick:K}},[C,b,K]);const oe=t.useCallback(()=>{l({type:"BOOKMARK"}),"function"==typeof f&&f()},[l,f]);return t.createElement("div",{className:"editor deepnotes-editor-theme-light"},y&&t.createElement(E,{onExpandAllClick:te,onCollapseAllClick:ne,onIndentClick:$,onOutdentClick:ee,onToggleCompletionClick:V,isBookmarked:I&&!!I.getCurrentContent().getBlockMap().get(S).getIn(["data","bookmarked"]),onBookmarkClick:oe}),t.createElement("div",{className:"editor_styles-module_container__3H-_W",tabIndex:0,onFocus:function(){P()},style:{minHeight:300,...m}},t.createElement(d.Provider,{value:fe},t.createElement(o.Editor,{webDriverTestID:"dumpster-editor",textAlignment:"left",ref:r,editorState:I,onChange:function(e){const{contentState:t,anchorBlock:n,selectionState:a}=v(e);let r=e;if(n&&"unordered-list-item"!==n.getType()){const n=o.Modifier.setBlockType(t,a,"unordered-list-item");r=o.EditorState.push(e,n,"force-list-type")}l({type:"CHANGE",editorState:r})},blockRendererFn:function(e){if("unordered-list-item"===e.getType())return{component:Y,editable:!0,props:{zoomedInItemId:S,baseDepth:x,searchText:s,hidden:ue(I,e,S,s),onExpandClick:b,onCollapseClick:K}}},handleReturn:W,handlePastedText:function(e){return _(function(e,t){const{contentState:n,selectionState:a}=v(e);return o.EditorState.push(e,o.Modifier.replaceText(n,a,t),"paste-text")}(I,e)),"handled"},stripPastedStyles:!0,keyBindingFn:function(e){if(o.KeyBindingUtil.hasCommandModifier(e)||o.KeyBindingUtil.isCtrlKeyCommand(e))switch(e.keyCode){case 191:return"toggle-keyboard-shortcut-panel";case 38:return e.shiftKey?"move-up":"collapse-list";case 40:return e.shiftKey?"move-down":"expand-list";case 190:return"zoom-in";case 188:return"zoom-out";case 13:return"toggle-completion";case 222:return"go-to-home";case 8:return e.shiftKey?"delete-item":o.getDefaultKeyBinding(e);default:return o.getDefaultKeyBinding(e)}else if(9===e.keyCode)return R(e);return o.getDefaultKeyBinding(e)},handleKeyCommand:function(e){switch(e){case"move-up":return q(),"handled";case"move-down":return G(),"handled";case"collapse-list":return function(){const{anchorKey:e}=v(c.editorState);e&&l({type:"COLLAPSE_ITEM",blockKey:e})}(),"handled";case"expand-list":return function(){const{anchorKey:e}=v(c.editorState);e&&l({type:"EXPAND_ITEM",blockKey:e})}(),"handled";case"split-block":return s||_(function(e,t){const{contentState:n,selectionState:a,blockMap:r}=v(e);if(!a.isCollapsed())return e;const c=a.getAnchorKey();let l=r.get(c);const s=l.getText(),i=l.getIn(["data","collapsed"]),d=t===l.getKey();let u,g,p=a.getAnchorOffset();const m=l.getCharacterList();if(d&&0===p&&(p=l.getText().length),d||!i&&z(r,l.getKey())&&0!==a.getStartOffset()){const e=j(r,l.getKey());u=e.count()>0?D(0,e.first().getIn(["data","pos"])):B(1),g=l.getKey()}else{const e=F(r,l.getKey());if(u=e?D(l.get("data").get("pos"),e.get("data").get("pos")):N(l.getIn(["data","pos"])),g=l.getIn(["data","parentId"]),0===a.getStartOffset()){const e=l.getIn(["data","pos"]);l=l.setIn(["data","pos"],u),u=e,p=l.getText().length}}let f=r.set(l.getKey(),l.set("text",s.slice(0,p)).set("characterList",m.slice(0,p)));const y=A({text:s.slice(p)}).set("depth",r.get(g).getDepth()+1).setIn(["data","parentId"],g).setIn(["data","pos"],u);f=f.set(y.getKey(),y),f=H(n.merge({blockMap:f}),f,g);const h=n.merge({blockMap:f,selectionBefore:a,selectionAfter:a.merge({anchorKey:y.getKey(),anchorOffset:0,focusKey:y.getKey(),focusOffset:0,isBackward:!1})});return o.EditorState.push(e,h,"split-block")}(I,c.zoomedInItemId)),"handled";case"zoom-in":return function(){const{anchorKey:e}=v(I);C(e)}(),"handled";case"zoom-out":return function(){const{editorState:e,zoomedInItemId:t}=c;if(!t)return void console.log("nothing is zoomed in so nothing to zoom out.");const n=X(e,t);n&&C(n.getKey())}(),"handled";case"toggle-completion":return V(),"handled";case"backspace":const{contentState:t,blockMap:n,selectionState:a}=v(c.editorState),r=n.get(a.getAnchorKey());if(""===r.getText()||0===a.getAnchorOffset()){const e=t.getBlockBefore(r.getKey());return n.get(a.getAnchorKey()).getIn(["data","hasChildren"])||!e||2===n.count()||r.getKey()===c.zoomedInItemId?"handled":"not-handled"}return"not-handled";case"go-to-home":return Q(),"handled";case"delete-item":return J(),"handled";default:const i=o.RichUtils.handleKeyCommand(I,e);return i?(_(i),"handled"):"not-handled"}},onFocus:()=>console.log("editor got focus"),placeholder:"Start writing",blockStyleFn:me,customStyleMap:{CODE:{color:"#15141f",background:"#eae9ed",fontFamily:"Monaco,Menlo,Ubuntu Mono,Droid Sans Mono,Consolas,monospace",fontSize:"0.9em",padding:"0 0.25rem",margin:"0 0.0625rem",borderRadius:"0.125rem",overflowWrap:"break-word",wordWrap:"break-word"}}}),t.createElement(pe,{max:40})),t.createElement("button",{className:n(h,k,"editor_styles-module_new-item-button__3yUxz"),onClick:function(){l({type:"SET_EDITOR_STATE",editorState:U(c.editorState,S,x+1)})},"aria-label":"Add new item",title:"Add new item"},t.createElement(Z,{className:"editor_styles-module_new-item-icon__3-ZVX","aria-label":"Add new item"}))))}var he=t.memo(ye);exports.ROOT_KEY=O,exports.createDecorators=T,exports.default=he,exports.findParent=X,exports.pluckGoodies=v;
//# sourceMappingURL=deepnotes-editor.cjs.production.min.js.map
